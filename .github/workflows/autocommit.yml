name: Commit Profile
on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 0,4,6,8,12,14,16,20,22, * * *"

jobs:
  auto_commit:
    runs-on: ubuntu-latest
    steps:
      - name: DEBUG
        run: echo "::debug::Ref = ${{ github.ref }}"

      - uses: actions/checkout@v3
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: Modify last update
        run: |
          d=$(date '+%Y-%m-%dT%H:%M:%SZ')
          echo $d > LAST_UPDATED

      - name: Commit changes
        run: |
          declare -a arr=("ðŸ˜‚" "ðŸ˜±" "ðŸ‘¿" "ðŸ™" "ðŸ" "ðŸ¤–" "ðŸŸ©" "ðŸ‘»" "ðŸŽ‰" "ðŸ”¥" "ðŸŒŸ" "ðŸ•" "âš¡" "ðŸŒˆ")

          # versi acak: 1â€“5 commit per run
          commits=$(( (RANDOM % 5) + 1 ))

          echo "Akan membuat $commits commit hari ini"

          git config --local user.email "habibiahmadaziz@gmail.com"
          git config --local user.name "habibiahmada"

          for i in $(seq 1 $commits); do
            # update isi file biar selalu ada perubahan unik
            d=$(date '+%Y-%m-%dT%H:%M:%S')-$i
            echo $d > LAST_UPDATED

            # pilih emoji random
            rand=$((RANDOM % ${#arr[@]}))

            git add -A
            git commit -m "feat: update ${arr[$rand]} ($i/$commits)"
          done


      - name: GitHub Push
        uses: ad-m/github-push-action@v0.6.0
        with:
          directory: "."
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: main
